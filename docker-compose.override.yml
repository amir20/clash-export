version: '3.2'
services:
  db:
    image: mongo:3.6
    hostname: mongo
    volumes:
      - ./:/clashleaders
      - ./mongosnapshot:/docker-entrypoint-initdb.d

  worker:
    env_file: .env
    restart: 'no'
    volumes:
      - ./clashleaders:/app/clashleaders
      - .ipython/scheduler:/root/.ipython/profile_default
    depends_on:
      - db

  web:
    env_file: .env
    restart: 'no'
    depends_on:
      - db
    ports:
      - "8000:80"
    volumes:
      - ./clashleaders:/app/clashleaders
      - ./tests/:/app/tests
      - ./setup.cfg:/app/setup.cfg
      - ./Makefile:/app/Makefile
      - ./caddy/Caddyfile.local:/etc/Caddyfile
      - .ipython/web:/root/.ipython/profile_default

  scheduler:
    env_file: .env
    restart: 'no'
    volumes:
      - ./clashleaders:/app/clashleaders
      - .ipython/scheduler:/root/.ipython/profile_default
    depends_on:
      - db
