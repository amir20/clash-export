<template>
  <div class="columns is-vcentered is-mobile">
    <div class="column is-8 has-text-right">
      {{ title }}
    </div>
    <div class="column is-4 is-size-1 grade" :class="gradeColor(score)">
      {{ score | grade }}
    </div>
  </div>
</template>

<script>
import { mapState } from "vuex";

const grades = ["A+", "A", "A-", "B+", "B", "B-", "C+", "C", "C-", "D+", "D", "D-", "E", "F"];

export default {
  props: {
    score: { type: Number },
    field: { type: String },
    title: { type: String }
  },
  watch: {
    scoreValue(newValue, oldValue) {
      this.score = newValue;
    }
  },
  computed: {
    ...mapState(["clan"]),
    scoreValue() {
      return this.field.split(".").reduce((prev, curr) => (prev ? prev[curr] : null), this.clan);
    }
  },
  methods: {
    gradeColor(value) {
      const grade = this.$options.filters.grade(value);
      const classes = [];
      if (["A"].indexOf(grade.charAt(0)) > -1) {
        classes.push("has-text-success");
      }

      if (["B", "C"].indexOf(grade.charAt(0)) > -1) {
        classes.push("has-text-grey");
      }

      if (["D", "E", "F"].indexOf(grade.charAt(0)) > -1) {
        classes.push("has-text-danger");
      }

      return classes;
    }
  },
  filters: {
    grade(value) {
      const s = Math.ceil((100 - value * 100) / 3);
      return grades[Math.min(s, grades.length - 1)];
    }
  }
};
</script>
<style lang="scss">
.scoreboard .panel-block {
  display: block !important;
}
</style>

<style lang="scss" scoped>
.grade {
  font-weight: lighter;
}
</style>
